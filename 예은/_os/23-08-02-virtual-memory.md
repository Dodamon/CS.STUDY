# Virtual Memory

이전까지는 메모리에 process 전체가 올라가는 경우 만을 생각했다. 하지만 프로그램이 너무 커져서 메모리에 process 전체가 올라가지 못한다면 어떻게 해야할까? 이를 위해 등장한 것이 가상메모리이다.

가상메모리는 process 전체가 메모리에 올라오지 않더라도 실행이 간능하도록 하는 기법이다

실제의 물리 메모리 개념과 개발자의 입장에서의 논리 메모리 개념을 분리함으로써 개발자가 물리적 메모리 크기에 관한 문제를 염려하지 않고 쉽게 프로그램을 작성 할 수 있도록 해준다

운영체제는 가상 메모리 기법을 통해 프로그램의 논리적 주소 영역에서 필요한 부분만 물리 메모리에 적재하고 직접 필요하지 않는 메모리 공간은 디스크 Swap 영역에 저장하게 된다.

> 논리적 주소(logical address)
>
> process가 memory에 적재되기 위한 독자적인 주소 공간인 논리적 주소(logical address)가 생성된다. 논리적 주소는 각 process마다 독립적으로 할당되며, 0번지부터 시작된다.

> 물리적 주소(physical address
>
> 물리적 주소(physical address)는 process가 실제로 메모리에 적재되는 위치를 말한다.

> 주소 바인딩(address binding)
>
> CPU가 기계어 명령을 수행하기 위해 process**의 논리적 주소가 실제 물리적 메모리의 어느 위치에 매핑되는지 확인하는 과정**을 주소 바인딩(address binding)이라고 한다.

### Demand paging (요구 페이징) 과 Page fault

당장 필요한 주소공간을 page 단위로 메모리에 적재하는 방법을 요구 페이징이라고 한다.

당장 실행에 필요한 page만을 메모리에 적재하기 때문에 메모리 사용량이 감소하고, 프로세스 전체를 메모리에 적재하는 입출력 오버헤드도 감소하는 장점이 있다.

요구 페이징 기법에서는 **유효/무효 비트(valid/invalid bit)**를 두어 각 page가 메모리에 존재하는지 표시하게 된다.

만약 필요한 page가 메모리에 없는 경우 즉 무효 비트가 표시된 page에 엑세스하는 경우 Page fault가 발생하고 주소 변환을 담당하는 하드웨어인 MMU 가 page fault trap 을 발생 시켜 디스크 에서 page를 빈 프레임에 적재하고 page table을 업데이트 한다.

### 페이지 교체 알고리즘 : Page replacement algorithm

page fault 가 발생해서 요청된 page 를 디스크에서 메인 메모리로 가져온다. 만약 메인 메모리도 공간이 부족하다면 메모리에 올라와있는 page를 디스크로 옮겨 메모리를 확보한다 이것을 페이지 교체하고 한다.

교체 알고리즘은 최대한 page fault가 적게 일어나도록 도와줘야 한다. 따라서 앞으로 참조될 가능성이 적은 page를 선택해서 교체하는 것이 성능을 향상시키는 방법이다.

| 알고리즘                   | 설명                                                                               |
| -------------------------- | ---------------------------------------------------------------------------------- |
| FIFO(First In First Out)   | 메모리에 올라온지 가장 오래된 page를 교체한다.                                     |
| 최적 페이지 교체           | 앞으로 가장 오랫동안 사용되지 않을 page를 찾아 교체한다. 실제구현은 어렵다         |
| LRU(Least Recently Used)   | 가장 오랫동안 사용되지 않은 page를 교체한다.                                       |
| LFU(Least Frequently Used) | 참조 횟수가 가장 적은 page를 교체한다. 비용대비 성능이 좋지 않아 잘 쓰이진 않는다. |
